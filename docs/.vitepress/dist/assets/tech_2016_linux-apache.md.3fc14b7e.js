import{_ as s,B as e,o as n,c as p,G as l,Q as t}from"./chunks/framework.1fee3549.js";const g=JSON.parse('{"title":"Linux下服务器环境的搭建和配置之一——Apache篇","description":"","frontmatter":{},"headers":[],"relativePath":"tech/2016/linux-apache.md","filePath":"tech/2016/linux-apache.md"}'),o={name:"tech/2016/linux-apache.md"},c=t(`<h1 id="linux下服务器环境的搭建和配置之一——apache篇" tabindex="-1">Linux下服务器环境的搭建和配置之一——Apache篇 <a class="header-anchor" href="#linux下服务器环境的搭建和配置之一——apache篇" aria-label="Permalink to &quot;Linux下服务器环境的搭建和配置之一——Apache篇&quot;">​</a></h1><p>最近一个多月(2016-06-20开始至今)，一直在忙海外广告平台FAQ系统的开发，既要负责服务器环境的搭建，又要写前端，还要写后台和数据库，甚至还要考虑产品需求和设计。所以是一个很大的挑战，对自身也是一个很好的锻炼机会，必须全力以赴，这一个多月几乎每天加班到晚上9点多才回家，有时周末也会来加班。陪女票的时间就少了，Sorry~My Dear~，等忙完这一阵子，闲下来打算陪亲去四川九寨沟玩个十天八天的，放松下心情~</p><p>闲言少叙，这一系列的文章主要聊聊自己这段时间搭建服务器环境的经验和踩过的坑，这一块也是我的薄弱项，估计写得内容不深，主要是给初学者看的，大神勿喷哈~</p><p>------------------------------------------------------------------- 华丽的分割线 ---------------------------------------------------------------------------</p><p>我的Linux系统版本是：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;"># cat /etc/redhat-release</span></span>
<span class="line"><span style="color:#babed8;">CentOS Linux release 6.2 (Final)</span></span></code></pre></div><p><img src="https://user-images.githubusercontent.com/9566362/227754261-1e7d4bac-0246-4105-b502-2982f9cea32b.png" alt="image"></p><p>(一)下载Apache 　　Apache官网：<a href="http://httpd.apache.org/%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%EF%BC%9Ahttp://httpd.apache.org/download.cgi%EF%BC%8C%E6%88%96%E8%80%85%E7%9B%B4%E6%8E%A5%E7%82%B9%E5%87%BB%5B%E8%BF%99%E9%87%8C%5D(http://mirrors.cnnic.cn/apache//httpd/httpd-2.4.23.tar.gz)%E4%B8%8B%E8%BD%BD%E3%80%82" target="_blank" rel="noreferrer">http://httpd.apache.org/，下载地址：http://httpd.apache.org/download.cgi，或者直接点击[这里](http://mirrors.cnnic.cn/apache//httpd/httpd-2.4.23.tar.gz)下载。</a></p><p>下载下来是一个源码的压缩包：httpd-2.4.23.tar.gz。</p><p>(二)安装Apache 　　1.解压</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">tar zxvf httpd-2.4.23.tar.gz</span></span>
<span class="line"><span style="color:#babed8;">cd httpd-2.4.23</span></span></code></pre></div><p>2.检查环境，生成 Makefile 文件</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">./configure --prefix=/usr/local/apache --sysconfdir=/usr/local/apache/conf --with-apr=/usr/local/apr-1.4.5 --with-apr-util=/usr/local/apr-util-1.3.12  --with-pcre=/usr/local/pcre  --enable-module=so</span></span></code></pre></div><p>3.编译</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">make</span></span></code></pre></div><p>4.安装</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">make install</span></span></code></pre></div><p>安装完之后，可以使用</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;"># httpd -v</span></span>
<span class="line"><span style="color:#babed8;">Server version: Apache/2.4.12 (Unix)</span></span>
<span class="line"><span style="color:#babed8;">Server built:   Jul 23 2016 16:18:26</span></span></code></pre></div><p>查看 Apache 的版本号，当然也可以验证 Apache 是否成功安装。</p><p>5.注意</p><p>Apache的安装依赖于以下三个模块：</p><p>(1)<a href="http://archive.apache.org/dist/apr/apr-1.4.5.tar.gz" target="_blank" rel="noreferrer">apr-1.4.5.tar.gz</a></p><p>(2)<a href="http://archive.apache.org/dist/apr/apr-util-1.3.12.tar.gz" target="_blank" rel="noreferrer">apr-util-1.3.12.tar.gz</a></p><p>(3)<a href="http://jaist.dl.sourceforge.net/project/pcre/pcre/8.10/pcre-8.10.zip" target="_blank" rel="noreferrer">pcre-8.10.zip</a></p><p>需要先下载并解压。</p><p>(三)Apache服务器的配置 　　默认 Apache 的配置文件在安装目录下的：/usr/local/apache/conf/httpd.conf。</p><p>主要配置以下字段，其他的默认就好：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">Listen ip:8080</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">Include conf/vhosts/*.conf</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">LoadModule unixd_module modules/mod_unixd.so</span></span>
<span class="line"><span style="color:#babed8;">LoadModule access_compat_module modules/mod_access_compat.so</span></span>
<span class="line"><span style="color:#babed8;">LoadModule authz_host_module modules/mod_authz_host.so</span></span>
<span class="line"><span style="color:#babed8;">LoadModule authz_core_module modules/mod_authz_core.so</span></span>
<span class="line"><span style="color:#babed8;">LoadModule dir_module modules/mod_dir.so</span></span>
<span class="line"><span style="color:#babed8;">LoadModule log_config_module modules/mod_log_config.so</span></span>
<span class="line"><span style="color:#babed8;">LoadModule mime_module modules/mod_mime.so</span></span>
<span class="line"><span style="color:#babed8;">#支持PHP</span></span>
<span class="line"><span style="color:#babed8;">LoadModule php5_module modules/libphp5.so</span></span>
<span class="line"><span style="color:#babed8;">AddType application/x-httpd-php .php</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">ServerName 127.0.0.1:8080</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">DocumentRoot &quot;/usr/local/apache/htdocs&quot;</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">&lt;Directory &quot;/usr/local/apache/htdocs&quot;&gt;</span></span>
<span class="line"><span style="color:#babed8;">    Options Indexes FollowSymLinks</span></span>
<span class="line"><span style="color:#babed8;">    AllowOverride All</span></span>
<span class="line"><span style="color:#babed8;">    Require all granted</span></span>
<span class="line"><span style="color:#babed8;">&lt;/Directory&gt;</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">&lt;IfModule dir_module&gt;</span></span>
<span class="line"><span style="color:#babed8;">    DirectoryIndex index.php index.html</span></span>
<span class="line"><span style="color:#babed8;">&lt;/IfModule&gt;</span></span></code></pre></div><p>下面是 httpd-vhosts.conf 文件：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">&lt;VirtualHost *:8080&gt;</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">        ServerName XXX.XXX.com</span></span>
<span class="line"><span style="color:#babed8;">        DocumentRoot &quot;/usr/local/apache/htdocs&quot;</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">        &lt;Directory &quot;/usr/local/apache/htdocs&quot;&gt;</span></span>
<span class="line"><span style="color:#babed8;">            Options Indexes FollowSymLinks</span></span>
<span class="line"><span style="color:#babed8;">            AllowOverride none</span></span>
<span class="line"><span style="color:#babed8;">            Order allow,deny</span></span>
<span class="line"><span style="color:#babed8;">            Allow from all</span></span>
<span class="line"><span style="color:#babed8;">            DirectoryIndex index.php index.html</span></span>
<span class="line"><span style="color:#babed8;">        &lt;/Directory&gt;</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">        ProxyPass /feedback http://ip:8000/feedback</span></span>
<span class="line"><span style="color:#babed8;">        ProxyPassReverse /feedback http://ip:8000/feedback</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">&lt;/VirtualHost&gt;</span></span></code></pre></div><p>其中 ProxyPass 这两行是配置代理和反向代理，用于访问其他域的资源。</p><p>(四)Apache服务器的启动、停止和重启 　　启动：apachectl start</p><p>停止：apachectl stop</p><p>重启：apachectl restart</p><p>使用 apachectl 命令之前要把 Apache 的 bin 目录配置到环境变量里：</p><p>在 /etc/profile 的最后一行加上：</p><p>export PATH=&quot;/usr/local/apache/bin:$PATH&quot; 　　保存后，输入：</p><p>source /etc/profile 　　使更改生效。</p><p>启动之后，可以使用：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;"># ps -ef | grep httpd</span></span>
<span class="line"><span style="color:#babed8;">root      2827     1  0 Jul27 ?        00:00:08 /usr/local/apache/bin/httpd --version</span></span>
<span class="line"><span style="color:#babed8;">daemon    2828  2827  0 Jul27 ?        00:00:00 /usr/local/apache/bin/httpd --version</span></span>
<span class="line"><span style="color:#babed8;">daemon    2829  2827  0 Jul27 ?        00:00:00 /usr/local/apache/bin/httpd --version</span></span>
<span class="line"><span style="color:#babed8;">daemon    2830  2827  0 Jul27 ?        00:00:00 /usr/local/apache/bin/httpd --version</span></span>
<span class="line"><span style="color:#babed8;">root     23135 19779  0 12:09 pts/0    00:00:00 grep httpd</span></span>
<span class="line"><span style="color:#babed8;">daemon   28164  2827  0 Jul27 ?        00:00:00 /usr/local/apache/bin/httpd --version</span></span></code></pre></div><p>查看 Apache 服务启动了没有，或者也可以使用：</p><h1 id="netstat-lntp" tabindex="-1">netstat -lntp <a class="header-anchor" href="#netstat-lntp" aria-label="Permalink to &quot;netstat -lntp&quot;">​</a></h1><p>Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name<br> tcp 0 0 ip:8080 0.0.0.0:* LISTEN 2827/httpd</p><p>(五)可以遇到的问题和相应的解决方案 　　问题1：</p><p>AH00557: httpd: apr_sockaddr_info_get() failed for AD AH00558: httpd: Could not reliably determine the server&#39;s fully qualified domain name, using 127.0.0.1. Set the &#39;ServerName&#39; directive globally to suppress this message 　　解决方案：</p><p>上面报了两个错误，分别解决：</p><p>(1)AH00557: httpd: apr_sockaddr_info_get() failed for AD</p><p>echo ip &gt; /etc/hostname /bin/hostname -F /etc/hostname apachectl restart 　　(2)AH00558: httpd: Could not reliably determine the server&#39;s fully qualified domain name...</p><p>/usr/local/apache/conf/httpd.conf 中：</p><p>ServerName localhost</p><p>问题2：</p><p>libc.so.6: version \`GLIBC_2.14&#39; not found 　　解决方案：</p><p>这时因为缺少glibc依赖模块，需要安装glibc。</p><p>(1)下载 <a href="http://mirrors.ustc.edu.cn/gnu/libc/glibc-2.14.tar.gz" target="_blank" rel="noreferrer">glibc-2.14.tar.gz</a></p><p>(2)解压</p><p>tar zxvf glibc-2.14.tar.gz cd glibc-2.14 　　(3)新建 build 目录</p><p>mkdir build cd build 　　(4)运行 configure，并编译、安装</p><p>../configure --prefix=/usr/local/glibc make -j4 make install</p>`,59);function r(i,d,b,h,u,m){const a=e("EditInfo");return n(),p("div",null,[c,l(a,{time:"2016-07-08 22:34",title:"阅读(1103)  评论(0)"})])}const f=s(o,[["render",r]]);export{g as __pageData,f as default};
