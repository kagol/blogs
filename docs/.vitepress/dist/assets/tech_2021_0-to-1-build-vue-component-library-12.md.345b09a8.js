import{_ as a,B as n,o as l,c as p,G as o,Q as e}from"./chunks/framework.1fee3549.js";const h=JSON.parse('{"title":"从0到1搭建Vue组件库12：实现tree组件自定义图标和节点勾选功能","description":"","frontmatter":{},"headers":[],"relativePath":"tech/2021/0-to-1-build-vue-component-library-12.md","filePath":"tech/2021/0-to-1-build-vue-component-library-12.md"}'),t={name:"tech/2021/0-to-1-build-vue-component-library-12.md"},c=e(`<h1 id="从0到1搭建vue组件库12-实现tree组件自定义图标和节点勾选功能" tabindex="-1">从0到1搭建Vue组件库12：实现tree组件自定义图标和节点勾选功能 <a class="header-anchor" href="#从0到1搭建vue组件库12-实现tree组件自定义图标和节点勾选功能" aria-label="Permalink to &quot;从0到1搭建Vue组件库12：实现tree组件自定义图标和节点勾选功能&quot;">​</a></h1><p><img src="https://user-images.githubusercontent.com/9566362/201510832-b75d2952-47b7-40c9-a363-f903840cc91b.png" alt="image"></p><h2 id="_0-上一期回顾" tabindex="-1">0 上一期回顾 <a class="header-anchor" href="#_0-上一期回顾" aria-label="Permalink to &quot;0 上一期回顾&quot;">​</a></h2><p>上一期直播我们完善了tree组件的样式，并增加了点选高亮、禁止展开/收起、禁止选择等功能。</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dba0ecccabd4444d87372561d387d57c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>当时还识别到了点选高亮功能<code>use-highlight</code>的一个小小的瑕疵点，这个瑕疵很快由<a href="https://gitee.com/pineaple" target="_blank" rel="noreferrer">pineaple</a>同学进行了优化。</p><p>改进方案： <a href="https://gitee.com/devui/vue-devui/pulls/353" target="_blank" rel="noreferrer">https://gitee.com/devui/vue-devui/pulls/353</a></p><h2 id="_1-自定义图标" tabindex="-1">1 自定义图标 <a class="header-anchor" href="#_1-自定义图标" aria-label="Permalink to &quot;1 自定义图标&quot;">​</a></h2><h3 id="_1-1-定义icon插槽" tabindex="-1">1.1 定义icon插槽 <a class="header-anchor" href="#_1-1-定义icon插槽" aria-label="Permalink to &quot;1.1 定义icon插槽&quot;">​</a></h3><p>编写之前先思考下：</p><blockquote><p>我们的插槽应该写在哪里？</p></blockquote><p><code>tree.tsx</code>中的<code>renderIcon</code>方法</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">const renderIcon = (item: TreeItem) =&gt; {</span></span>
<span class="line"><span style="color:#babed8;">  return item.children</span></span>
<span class="line"><span style="color:#babed8;">    ? &lt;span class={item.disableToggle &amp;&amp; &#39;toggle-disabled&#39;} onClick={() =&gt; toggle(item)}&gt;</span></span>
<span class="line"><span style="color:#babed8;">        {</span></span>
<span class="line"><span style="color:#babed8;">          // 增加插槽逻辑</span></span>
<span class="line"><span style="color:#babed8;">          ctx.slots.icon </span></span>
<span class="line"><span style="color:#babed8;">            ? ctx.slots.icon(item)</span></span>
<span class="line"><span style="color:#babed8;">            : item.open</span></span>
<span class="line"><span style="color:#babed8;">              ? &lt;IconOpen class=&#39;mr-xs&#39; /&gt;</span></span>
<span class="line"><span style="color:#babed8;">              : &lt;IconClose class=&#39;mr-xs&#39; /&gt;</span></span>
<span class="line"><span style="color:#babed8;">        }</span></span>
<span class="line"><span style="color:#babed8;">      &lt;/span&gt;</span></span>
<span class="line"><span style="color:#babed8;">    : &lt;Indent /&gt;</span></span>
<span class="line"><span style="color:#babed8;">}</span></span></code></pre></div><p><code>IconOpen.tsx</code></p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> IconOpen </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">svg</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">viewBox</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0 0 1024 1024</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">xmlns</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://www.w3.org/2000/svg</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">p-id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">4160</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">12</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">12</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    &gt;</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">d</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">M64 320l448 448 448-448z</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">fill</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#8C92A4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">p-id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">4161</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">svg</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> IconOpen</span></span></code></pre></div><p><code>IconClose.tsx</code></p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> IconClose </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">svg</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">viewBox</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0 0 1024 1024</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">xmlns</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://www.w3.org/2000/svg</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">p-id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">4361</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">12</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">12</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    &gt;</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">d</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">M256 64l448 448-448 448z</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">fill</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#8C92A4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">p-id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">4362</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">svg</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> IconClose</span></span></code></pre></div><h3 id="_1-2-使用插槽" tabindex="-1">1.2 使用插槽 <a class="header-anchor" href="#_1-2-使用插槽" aria-label="Permalink to &quot;1.2 使用插槽&quot;">​</a></h3><p><code>JSX</code>和<code>SFC</code>中插槽使用的写法对比。</p><p><code>JSX</code>：</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">d-tree</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">data</span><span style="color:#89DDFF;">={</span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">}&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">icon</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TreeItem</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> (item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">open </span><span style="color:#89DDFF;">?</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">IconOpen</span><span style="color:#89DDFF;"> /&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">IconClose</span><span style="color:#89DDFF;"> /&gt;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">d-tree</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p><code>SFC</code>：</p><div class="language-vue"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">d-tree</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">data</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  &lt;template #icon=&quot;item&quot;&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    &lt;IconOpen v-if=&quot;item.open&quot; /&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    &lt;IconClose v-else /&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  &lt;/template&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">d-tree</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>效果如下：</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e3159acdf9024198a85ad0fc2b110635~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h2 id="_2-节点勾选" tabindex="-1">2 节点勾选 <a class="header-anchor" href="#_2-节点勾选" aria-label="Permalink to &quot;2 节点勾选&quot;">​</a></h2><h3 id="_2-1-新增checkable和checked" tabindex="-1">2.1 新增checkable和checked <a class="header-anchor" href="#_2-1-新增checkable和checked" aria-label="Permalink to &quot;2.1 新增checkable和checked&quot;">​</a></h3><p><code>tree-types.ts</code></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">export const treeProps = {</span></span>
<span class="line"><span style="color:#babed8;">  data: {</span></span>
<span class="line"><span style="color:#babed8;">    type: Array as PropType&lt;TreeData&gt;,</span></span>
<span class="line"><span style="color:#babed8;">    default: () =&gt; [],</span></span>
<span class="line"><span style="color:#babed8;">  },</span></span>
<span class="line"><span style="color:#babed8;">  </span></span>
<span class="line"><span style="color:#babed8;">  // 新增</span></span>
<span class="line"><span style="color:#babed8;">  checkable: {</span></span>
<span class="line"><span style="color:#babed8;">    type: Boolean,</span></span>
<span class="line"><span style="color:#babed8;">    default: false</span></span>
<span class="line"><span style="color:#babed8;">  },</span></span>
<span class="line"><span style="color:#babed8;">} as const</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">export interface TreeItem {</span></span>
<span class="line"><span style="color:#babed8;">  label: string</span></span>
<span class="line"><span style="color:#babed8;">  children?: TreeData</span></span>
<span class="line"><span style="color:#babed8;">  open?: boolean</span></span>
<span class="line"><span style="color:#babed8;">  disableToggle?: boolean,</span></span>
<span class="line"><span style="color:#babed8;">  checked?: boolean, // 新增</span></span>
<span class="line"><span style="color:#babed8;">  [key: string]: any</span></span>
<span class="line"><span style="color:#babed8;">}</span></span></code></pre></div><h3 id="_2-2-添加checkbox组件" tabindex="-1">2.2 添加Checkbox组件 <a class="header-anchor" href="#_2-2-添加checkbox组件" aria-label="Permalink to &quot;2.2 添加Checkbox组件&quot;">​</a></h3><p><code>tree.tsx</code></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">const { data, checkable } = toRefs(props)</span></span></code></pre></div><p><code>tree.tsx</code>中的<code>renderNode</code>方法</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">{ renderIcon(item) }</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">// 新增</span></span>
<span class="line"><span style="color:#babed8;">{ checkable.value &amp;&amp; &lt;d-checkbox v-model={item.checked} /&gt;}</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">&lt;span class={[&#39;devui-tree-node__title&#39;, disabled &amp;&amp; &#39;select-disabled&#39;]}&gt;</span></span>
<span class="line"><span style="color:#babed8;">  { label }</span></span>
<span class="line"><span style="color:#babed8;">&lt;/span&gt;</span></span></code></pre></div><h3 id="_2-3-配置checkable" tabindex="-1">2.3 配置checkable <a class="header-anchor" href="#_2-3-配置checkable" aria-label="Permalink to &quot;2.3 配置checkable&quot;">​</a></h3><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 增加\`checkable={true}\`参数</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">d-tree</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">data</span><span style="color:#89DDFF;">={</span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">} </span><span style="color:#C792EA;">checkable</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">icon</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">node</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TreeItem</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> (node</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">open </span><span style="color:#89DDFF;">?</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">IconOpen</span><span style="color:#89DDFF;"> /&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">IconClose</span><span style="color:#89DDFF;"> /&gt;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">d-tree</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>效果如下：</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea29cc8ac32e489cb7ebd47a76fb7786~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>`,38);function r(D,y,F,i,d,b){const s=n("EditInfo");return l(),p("div",null,[c,o(s,{time:"2021年12月09日 19:22",title:"阅读 3707 ·  点赞 40 ·  评论 13 ·  收藏 19"})])}const B=a(t,[["render",r]]);export{h as __pageData,B as default};
