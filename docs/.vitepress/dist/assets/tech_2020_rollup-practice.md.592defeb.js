import{_ as a,B as n,o as l,c as o,G as p,Q as e}from"./chunks/framework.1fee3549.js";const t="/blogs/assets/rollup-practice-1.png",c="/blogs/assets/rollup-practice-2.png",r="/blogs/assets/rollup-practice-3.png",y="/blogs/assets/rollup-practice-4.png",D="/blogs/assets/rollup-practice-5.png",m=JSON.parse('{"title":"手把手教你用 Rollup 打包并发布自己的工具库📦","description":"","frontmatter":{},"headers":[],"relativePath":"tech/2020/rollup-practice.md","filePath":"tech/2020/rollup-practice.md"}'),F={name:"tech/2020/rollup-practice.md"},i=e(`<h1 id="手把手教你用-rollup-打包并发布自己的工具库📦" tabindex="-1">手把手教你用 Rollup 打包并发布自己的工具库📦 <a class="header-anchor" href="#手把手教你用-rollup-打包并发布自己的工具库📦" aria-label="Permalink to &quot;手把手教你用 Rollup 打包并发布自己的工具库📦&quot;">​</a></h1><p>随着前端生态的繁荣，工具库几乎是高效开发的必需品，<a href="https://github.com/lodash/lodash" target="_blank" rel="noreferrer">lodash</a> / <a href="https://github.com/iamkun/dayjs" target="_blank" rel="noreferrer">dayjs</a> / <a href="https://github.com/adamwdraper/Numeral-js" target="_blank" rel="noreferrer">numberal</a> 等实用的工具库相信大家都用过。</p><p>我近期在开发 <a href="https://github.com/kagol/calendar-graph/" target="_blank" rel="noreferrer">Calendar Graph</a> GitHub 提交日历组件时，发现有很多需要处理颜色的场景，比如：判断一个字符串是否是一个有效的颜色值、hex 颜色值和 rgb 颜色值的互转等，但没有找到一个能很好满足我全部需求的开源库，所以决定自己造一个轮子。</p><p>这就是我做 <a href="https://github.com/kagol/ktools" target="_blank" rel="noreferrer">ktools</a> 工具库的原因，本文将介绍如何使用 <a href="https://github.com/rollup/rollup" target="_blank" rel="noreferrer">Rollup</a> 这个轻量的下一代模块打包器打造自己的 TypeScript 工具库。</p><p>通过阅读本文，你将学到：</p><ol><li>如何初始化一个 Rollup 工程项目</li><li>如何配置 Rollup 和 TypeScript</li><li>如何编写脚本，构建并发布自己的工具库到 npm 仓库</li></ol><h2 id="_1-创建并初始化-github-项目" tabindex="-1">1 创建并初始化 GitHub 项目 <a class="header-anchor" href="#_1-创建并初始化-github-项目" aria-label="Permalink to &quot;1 创建并初始化 GitHub 项目&quot;">​</a></h2><p>做一个开源库的第一步是创建一个 GitHub(或 Gitlab 等)代码仓库，并进行简单的初始化，主要包括：</p><ol><li>创建Git提交忽略配置 .gitignore</li><li>创建开源协议声明 LICENSE</li><li>初始化 package.json</li><li>配置 TypeScript tsconfig.json</li><li>配置 Rollup rollup.config.js</li></ol><h3 id="_1-1-git提交忽略配置" tabindex="-1">1.1 Git提交忽略配置 <a class="header-anchor" href="#_1-1-git提交忽略配置" aria-label="Permalink to &quot;1.1 Git提交忽略配置&quot;">​</a></h3><p>为了防止 <code>node_modules</code> 等自动生成的目录/文件提交到远程代码仓库，提交忽略是首先要考虑的事情，前期可以简单配置下即可。</p><p>先创建一个 .gitignore 文件</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">touch .gitignore</span></span></code></pre></div><p>在新创建的.gitignore文件中增加以下内容：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;"># dependencies</span></span>
<span class="line"><span style="color:#babed8;">/node_modules</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;"># compiled output</span></span>
<span class="line"><span style="color:#babed8;">/dist</span></span></code></pre></div><p>详细的配置可以参考 GitHub 官方文档： <a href="https://docs.github.com/en/free-pro-team@latest/github/using-git/ignoring-files" target="_blank" rel="noreferrer">https://docs.github.com/en/free-pro-team@latest/github/using-git/ignoring-files</a></p><h3 id="_1-2-创建开源协议声明-license" tabindex="-1">1.2 创建开源协议声明 LICENSE <a class="header-anchor" href="#_1-2-创建开源协议声明-license" aria-label="Permalink to &quot;1.2 创建开源协议声明 LICENSE&quot;">​</a></h3><p>开源协议可以在创建 GitHub 仓库时选择，也可以创建仓库之后再加，一般选择 MIT 协议。</p><p>这里介绍一个创建仓库之后补加协议的小技巧。主要分成以下几个步骤：</p><ol><li>在 GitHub 仓库增加一个文件</li><li>输入 <code>LICENSE</code>（注意必须全部大写）</li><li>选择协议</li><li>提交</li></ol><h4 id="step-1-在-github-仓库增加一个文件" tabindex="-1">Step 1: 在 GitHub 仓库增加一个文件 <a class="header-anchor" href="#step-1-在-github-仓库增加一个文件" aria-label="Permalink to &quot;Step 1: 在 GitHub 仓库增加一个文件&quot;">​</a></h4><p>在代码仓库的目录结构右上方，有一个 <code>Add file</code> 下拉框，选择其中的 <code>Create new file</code> 选项，进入创建新文件的页面。</p><p><img src="`+t+'" alt=""></p><h4 id="step-2-输入-license" tabindex="-1">Step 2: 输入 &quot;LICENSE&quot; <a class="header-anchor" href="#step-2-输入-license" aria-label="Permalink to &quot;Step 2: 输入 &quot;LICENSE&quot;&quot;">​</a></h4><p>在文件名中输入全大些的 <code>LICENSE</code>，这时输入框右边会多出来一个按钮 <code>Choose a license template</code>。</p><p><img src="'+c+'" alt=""></p><h4 id="step-3-选择协议" tabindex="-1">Step 3: 选择协议 <a class="header-anchor" href="#step-3-选择协议" aria-label="Permalink to &quot;Step 3: 选择协议&quot;">​</a></h4><p>点击 <code>Choose a license template</code> 按钮，进入选择协议模板的页面。</p><p>我们在左侧目录选择 <code>MIT License</code>，然后在右侧边栏输入年份和作者名字，可以看到中间的 <code>Copyright (c)</code> 后面的年份和作者会相应变化，点击 <code>Review and submit</code> 按钮，即可返回创建文件的页面，并自动用刚刚选择的协议内容填充到 LICENSE 文件中。</p><p><img src="'+r+'" alt=""></p><h4 id="step-4-提交" tabindex="-1">Step 4: 提交 <a class="header-anchor" href="#step-4-提交" aria-label="Permalink to &quot;Step 4: 提交&quot;">​</a></h4><p>点击创建文件页面下方的<code>Commit new file</code>即可提交 LICENSE 文件到代码仓库。</p><p><img src="'+y+'" alt=""></p><p>提交之后会自动跳转到 LICENSE 页面，效果如下：</p><p><img src="'+D+`" alt=""></p><h3 id="_1-3-初始化-package-json" tabindex="-1">1.3 初始化 package.json <a class="header-anchor" href="#_1-3-初始化-package-json" aria-label="Permalink to &quot;1.3 初始化 package.json&quot;">​</a></h3><p>添加 <code>.gitignore</code> / <code>LICENSE</code> 这两个基本的文件之后，下一步就是初始化 <code>package.json</code> 文件，这是管理依赖包及其版本的包配置文件，前端项目必备。</p><p>我们可以使用以下命令创建一个默认的 package.json：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">init</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-y</span></span></code></pre></div><p>增加 <code>-y</code> 参数是不想一直按 Enter😄</p><p>创建好的 package.json 文件如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ktools</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">echo </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Error: no test specified</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> &amp;&amp; exit 1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">repository</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git+https://github.com/kagol/ktools.git</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">[],</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">license</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MIT</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>我们可以简单地修改和完善下。</p><p><code>name</code>和<code>version</code>分别是包名和版本号，均可后续发布时通过脚本动态修改，不用管。</p><p><code>description</code>描述可以加下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">前端工具库</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p><code>main</code>/<code>scripts</code>这些后续在构建部署脚本的章节会细讲。</p><p><code>keywords</code>/<code>author</code>可以加下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">toolkit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rollup</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">typescript</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">]</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Kagol</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,</span></span></code></pre></div><p>配置好 package.json，后续安装依赖包时会自动更新该文件，可以非常方便地进行依赖管理。</p><h3 id="_1-4-配置-typescript-tsconfig-json" tabindex="-1">1.4 配置 TypeScript tsconfig.json <a class="header-anchor" href="#_1-4-配置-typescript-tsconfig-json" aria-label="Permalink to &quot;1.4 配置 TypeScript tsconfig.json&quot;">​</a></h3><p>TypeScript 这种强类型的语言，是对 JavaScript 很好的补充和增强，目前来看前景很好，必须用起来。</p><h4 id="安装-tsc" tabindex="-1">安装 tsc <a class="header-anchor" href="#安装-tsc" aria-label="Permalink to &quot;安装 tsc&quot;">​</a></h4><p>我们可以使用 tsc 命令行工具快速创建 TypeScript 默认配置文件。</p><p>先确认下是否安装 tsc，输入命令：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">tsc</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-v</span></span></code></pre></div><p>出现以下命令说明未安装：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">-bash:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/bin/tsc:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">No</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">such</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">file</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">or</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">directory</span></span></code></pre></div><p>可以通过以下命令全局安装：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">typescript</span></span></code></pre></div><p>成功安装之后，再查看下tsc版本：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">tsc</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-v</span></span>
<span class="line"><span style="color:#FFCB6B;">Version</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">4.1</span><span style="color:#C3E88D;">.2</span></span></code></pre></div><h4 id="生成-tsconfig-json-配置文件" tabindex="-1">生成 tsconfig.json 配置文件 <a class="header-anchor" href="#生成-tsconfig-json-配置文件" aria-label="Permalink to &quot;生成 tsconfig.json 配置文件&quot;">​</a></h4><p>可以使用以下快速生成默认的 <code>tsconfig.json</code> 配置：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">tsc</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--init</span></span></code></pre></div><p>生成的 <code>tsconfig.json</code> 文件如下（已删除注释代码）：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">compilerOptions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">/* Visit https://aka.ms/tsconfig.json to read more about this file */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">/* Basic Options */</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">target</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">es5</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;">                          </span><span style="color:#676E95;font-style:italic;">/* Specify ECMAScript target version: &#39;ES3&#39; (default), &#39;ES5&#39;, &#39;ES2015&#39;, &#39;ES2016&#39;, &#39;ES2017&#39;, &#39;ES2018&#39;, &#39;ES2019&#39;, &#39;ES2020&#39;, or &#39;ESNEXT&#39;. */</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">commonjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;">                     </span><span style="color:#676E95;font-style:italic;">/* Specify module code generation: &#39;none&#39;, &#39;commonjs&#39;, &#39;amd&#39;, &#39;system&#39;, &#39;umd&#39;, &#39;es2015&#39;, &#39;es2020&#39;, or &#39;ESNext&#39;. */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">/* Strict Type-Checking Options */</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">strict</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">true,</span><span style="color:#BABED8;">                           </span><span style="color:#676E95;font-style:italic;">/* Enable all strict type-checking options. */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">/* Module Resolution Options */</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">esModuleInterop</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">true,</span><span style="color:#BABED8;">                  </span><span style="color:#676E95;font-style:italic;">/* Enables emit interoperability between CommonJS and ES Modules via creation of namespace objects for all imports. Implies &#39;allowSyntheticDefaultImports&#39;. */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">/* Advanced Options */</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">skipLibCheck</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">true,</span><span style="color:#BABED8;">                     </span><span style="color:#676E95;font-style:italic;">/* Skip type checking of declaration files. */</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">forceConsistentCasingInFileNames</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">true</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">/* Disallow inconsistently-cased references to the same file. */</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>默认的配置其实已经够用，我们不做修改，后续可以根据需要删减配置。</p><h3 id="_1-5-配置rollup-rollup-config-js" tabindex="-1">1.5 配置Rollup rollup.config.js <a class="header-anchor" href="#_1-5-配置rollup-rollup-config-js" aria-label="Permalink to &quot;1.5 配置Rollup rollup.config.js&quot;">​</a></h3><p>初始化工程的最后一步就是配置 Rollup，先创建一个 Rollup 配置文件，没有 Rollup CLI 工具不支持初始化配置文件，只能手动创建：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">touch</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">rollup.config.js</span></span></code></pre></div><p>然后在 <code>rollup.config.js</code> 中增加以下内容：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> resolve </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup-plugin-node-resolve</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> commonjs </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup-plugin-commonjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> typescript </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup-plugin-typescript</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> pkg </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./package.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 打包入口</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 打包出口</span></span>
<span class="line"><span style="color:#BABED8;">	</span><span style="color:#F07178;">file</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> pkg</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">browser</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 最终打包出来的文件路径和文件名，这里是在package.json的browser: &#39;dist/index.js&#39;字段中配置的</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">umd</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// umd是兼容amd/cjs/iife的通用打包格式，适合浏览器</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [ </span><span style="color:#676E95;font-style:italic;">// 打包插件</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">resolve</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 查找和打包node_modules中的第三方模块</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">commonjs</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 将 CommonJS 转换成 ES2015 模块供 Rollup 处理</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">typescript</span><span style="color:#BABED8;">() </span><span style="color:#676E95;font-style:italic;">// 解析TypeScript</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>在 <code>package.json</code> 中配置 <code>browser</code> 字段：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">browser</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/index.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,</span></span></code></pre></div><p>安装 Rollup 和 TypeScript 相关依赖：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-D</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">rollup</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">typescript</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">tslib</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">rollup-plugin-node-resolve</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">rollup-plugin-commonjs</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">rollup-plugin-typescript</span></span></code></pre></div><p>注意 <code>tslib</code> 这个依赖库也是必需的，因为 <code>rollup-plugin-typescript</code> 插件依赖了该库。</p><p>Rollup 配置文件每个配置项的具体含义可以参考：<a href="https://www.rollupjs.com/guide/big-list-of-options" target="_blank" rel="noreferrer">https://www.rollupjs.com/guide/big-list-of-options</a></p><p>Rollup 可用插件列表可以参考：<a href="https://github.com/rollup/plugins" target="_blank" rel="noreferrer">https://github.com/rollup/plugins</a></p><h2 id="_2-编写工具库源码" tabindex="-1">2 编写工具库源码 <a class="header-anchor" href="#_2-编写工具库源码" aria-label="Permalink to &quot;2 编写工具库源码&quot;">​</a></h2><p>有了以上的初始工程，就可以正式开始写工具方法源码。</p><h3 id="_2-1-走通流程" tabindex="-1">2.1 走通流程 <a class="header-anchor" href="#_2-1-走通流程" aria-label="Permalink to &quot;2.1 走通流程&quot;">​</a></h3><p>先写一个 demo，跑通<code>编写源码</code>、<code>构建打包</code>、<code>引入使用</code>的流程。</p><h4 id="编写源码" tabindex="-1">编写源码 <a class="header-anchor" href="#编写源码" aria-label="Permalink to &quot;编写源码&quot;">​</a></h4><p>咱们的入口文件配置在了 src/index.ts 中，所以需要先创建该文件：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">src</span></span>
<span class="line"><span style="color:#FFCB6B;">touch</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">src/index.ts</span></span></code></pre></div><p>然后在该文件中编写一些代码测试下打包是否正常：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello ktools!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="构建打包" tabindex="-1">构建打包 <a class="header-anchor" href="#构建打包" aria-label="Permalink to &quot;构建打包&quot;">​</a></h4><p>在命令行中输入以下命令对项目进行打包：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">rollup</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-c</span></span></code></pre></div><p>执行完之后会在 dist 目录生成打包文件 index.js，内容如下：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">(</span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">factory</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">define</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">function</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">define</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">amd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">define</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">factory</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#82AAFF;">factory</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">((</span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">use strict</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello ktools!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="引入使用" tabindex="-1">引入使用 <a class="header-anchor" href="#引入使用" aria-label="Permalink to &quot;引入使用&quot;">​</a></h4><p>这时我们可以随便在一个 Vue / React / Angular 项目下引入这个空壳工具库，看下是否正常：</p><p>比如在 Vue CLI 工程的 src/main.js 中增加以下代码</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> Vue </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App.vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> router </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./router</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> store </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./store</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> ktools </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../index</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 新增加的代码，将在浏览器控制台输出&quot;hello ktools!&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">Vue</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">config</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">productionTip </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Vue</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  router</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  store</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">render</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">h</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">h</span><span style="color:#BABED8;">(App)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">$mount</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>或者在 Angular CLI 工程中的 src/main.ts 文件中增加：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">enableProdMode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@angular/core</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">platformBrowserDynamic</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@angular/platform-browser-dynamic</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">AppModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./app/app.module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">environment</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./environments/environment</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> ktools </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../index</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ktools:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> ktools)</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 必须加这个才能输出&quot;hello ktools!&quot;，因为没有导出任何东西，所以打印出来的ktools是一个空对象</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> (environment</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">production) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">enableProdMode</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">platformBrowserDynamic</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">bootstrapModule</span><span style="color:#BABED8;">(AppModule)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#BABED8;">(</span><span style="color:#BABED8;font-style:italic;">err</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#BABED8;">(err))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h3 id="_2-2-编写工具方法" tabindex="-1">2.2 编写工具方法 <a class="header-anchor" href="#_2-2-编写工具方法" aria-label="Permalink to &quot;2.2 编写工具方法&quot;">​</a></h3><p>流程走通之后，就可以正式编写工具方法。</p><p>我们编写一个判断一个字符串是否是一个有效的 hex 十六进制颜色值的工具方法：isColor。</p><p>先创建 src/is-color.ts 文件：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">touch</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">src/is-color.ts</span></span></code></pre></div><p>增加以下内容：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 判断字符串是否是十六进制的颜色值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#676E95;font-style:italic;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> isColor </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">#</span><span style="color:#89DDFF;">([</span><span style="color:#C3E88D;">0-9a-fA-F</span><span style="color:#89DDFF;">]{6}|[</span><span style="color:#C3E88D;">0-9a-fA-F</span><span style="color:#89DDFF;">]{3})</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> isColor</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>然后在index.ts入口文件中增加引入is-color.ts文件的代码：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> isColor </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./is-color</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">isColor</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>重新执行 <code>rollup -c</code> 进行构建，生成的 dist/index.js 如下：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">(</span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">global</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">factory</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">object</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">undefined</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">factory</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">define</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">function</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">define</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">amd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">define</span><span style="color:#F07178;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">exports</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">factory</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  (</span><span style="color:#BABED8;">global</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">globalThis</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">undefined</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">globalThis</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">global</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">self</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">factory</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">global</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ktools</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">this,</span><span style="color:#BABED8;"> (</span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">exports</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">use strict</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * 判断字符串是否是十六进制的颜色值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">value</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">isColor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">#</span><span style="color:#89DDFF;">([</span><span style="color:#C3E88D;">0-9a-fA-F</span><span style="color:#89DDFF;">]{6}|[</span><span style="color:#C3E88D;">0-9a-fA-F</span><span style="color:#89DDFF;">]{3})</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">exports.</span><span style="color:#BABED8;">isColor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">isColor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">defineProperty</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">exports,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__esModule</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>再到项目中引入：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">isColor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../index</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">isColor #c6e48b:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">isColor</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#c6e48b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">))</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// isColor #c6e48b: true</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">isColor #c6e48:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">isColor</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#c6e48</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">))</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// isColor #c6e48: false</span></span></code></pre></div><p>一切正常！</p><h2 id="_3-增加构建发布脚本" tabindex="-1">3 增加构建发布脚本 <a class="header-anchor" href="#_3-增加构建发布脚本" aria-label="Permalink to &quot;3 增加构建发布脚本&quot;">​</a></h2><p>到这里其实我们的工具库 <code>ktools</code> 已经完成了 90%，还差最后一步，就是发布到 npm 仓库，可以手工发布。</p><h3 id="_3-1-手工发布" tabindex="-1">3.1 手工发布 <a class="header-anchor" href="#_3-1-手工发布" aria-label="Permalink to &quot;3.1 手工发布&quot;">​</a></h3><p>将 package.json 文件拷贝到 dist 目录，修改 version 为本次发布的版本号，比如：0.0.1，然后进入该目录：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">dist</span></span></code></pre></div><p>执行以下命令即可将我们的 ktools 工具库发布到 npm 仓库：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">publish</span></span></code></pre></div><p>带着欢呼雀跃的心情等待发布成功，结果报错，以下是报错信息：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">publish</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">📦</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">ktools@0.0.1</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">===</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Tarball</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Contents</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">===</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">315</span><span style="color:#C3E88D;">B</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">index.html</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">634</span><span style="color:#C3E88D;">B</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">index.js</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">691</span><span style="color:#C3E88D;">B</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">package.json</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">===</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Tarball</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Details</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">===</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">name:</span><span style="color:#BABED8;">          </span><span style="color:#C3E88D;">ktools</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">version:</span><span style="color:#BABED8;">       </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">.1</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">package</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">size:</span><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">1.1</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">kB</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">unpacked</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">size:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1.6</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">kB</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">shasum:</span><span style="color:#BABED8;">        </span><span style="color:#F78C6C;">35</span><span style="color:#C3E88D;">c3501906443ff46be51c2747c07e73136bf85c</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">integrity:</span><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">sha512-SZTM0msux0+Pt[...]IWmV6Gx5Tz41w==</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">total</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">files:</span><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">code</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">E403</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">403</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">403</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Forbidden</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">PUT</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">http://registry.npmjs.org/ktools</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Package</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">name</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">too</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">similar</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">to</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">existing</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">packages</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">try</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">renaming</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">your</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">package</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">to</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@kagol/ktools</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">and</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">publishing</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">with</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">npm publish --access=public</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">instead</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">403</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">In</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">most</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">cases,</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">you</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">or</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">one</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">of</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">your</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">dependencies</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">are</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">requesting</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">403</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">a</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">package</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">version</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">that</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">is</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">forbidden</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">by</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">your</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">security</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">policy.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">A</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">complete</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">log</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">of</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">this</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">run</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">can</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">be</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">found</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">in:</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">/Users/kagol/.npm/_logs/2020-12-05T05_42_31_632Z-debug.log</span></span></code></pre></div><p>看提示似乎是包名重复，提示里还很友好地建议先重命名包名为 <code>@kagol/ktools</code>，然后再发布。</p><p>那我们就按照提示尝试下改个名字吧，加个scope：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ktools</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">-&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@kagol/ktools</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,</span></span></code></pre></div><p>改完名字重新发布，成功啦！</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">publish</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">📦</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">@kagol/ktools@0.0.1</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">===</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Tarball</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Contents</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">===</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">22.0</span><span style="color:#C3E88D;">kB</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">index.js</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1.2</span><span style="color:#C3E88D;">kB</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">package.json</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1.8</span><span style="color:#C3E88D;">kB</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">README.md</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">===</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Tarball</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Details</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">===</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">name:</span><span style="color:#BABED8;">          </span><span style="color:#C3E88D;">@kagol/ktools</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">version:</span><span style="color:#BABED8;">       </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">.1</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">package</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">size:</span><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">6.9</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">kB</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">unpacked</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">size:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">25.0</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">kB</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">shasum:</span><span style="color:#BABED8;">        </span><span style="color:#C3E88D;">d85994aecc86160862cef4f0033e5bfdaa136072</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">integrity:</span><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">sha512-UEDEJEsMSXcMg[...]yY4KsXp4mXIBA==</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">total</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">files:</span><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span></span>
<span class="line"><span style="color:#FFCB6B;">+</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">@kagol/ktools@0.0.1</span></span></code></pre></div><p>这时可以在项目中正式安装并引入使用。</p><p>先安装：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">@kagol/ktools</span></span></code></pre></div><p>使用方式和之前的一样，只是需要修改引入方式：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">isColor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@kagol/ktools</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">isColor #c6e48b:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">isColor</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#c6e48b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">))</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// isColor #c6e48b: true</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">isColor #c6e48:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">isColor</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#c6e48</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">))</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// isColor #c6e48: false</span></span></code></pre></div><h3 id="_3-2-通过脚本发布" tabindex="-1">3.2 通过脚本发布 <a class="header-anchor" href="#_3-2-通过脚本发布" aria-label="Permalink to &quot;3.2 通过脚本发布&quot;">​</a></h3><p>每次发布还要将文件拷贝来拷贝去，又要修改包名，又要改版本号，很麻烦，可以编写脚本将这个过程自动化。</p><p>主要分以下步骤：</p><ol><li>拷贝文件</li><li>修改文件</li><li>发布</li></ol><h4 id="step-1-拷贝文件" tabindex="-1">Step 1: 拷贝文件 <a class="header-anchor" href="#step-1-拷贝文件" aria-label="Permalink to &quot;Step 1: 拷贝文件&quot;">​</a></h4><p>在 package.json 的 scripts 中增加拷贝文件的脚本：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">&quot;copy&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cp package.json README.md dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span></span></code></pre></div><h4 id="step-2-修改文件" tabindex="-1">Step 2: 修改文件 <a class="header-anchor" href="#step-2-修改文件" aria-label="Permalink to &quot;Step 2: 修改文件&quot;">​</a></h4><p>新建 scripts/publish.js 文件，增加以下内容：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> path </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> shelljs </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">shelljs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> program </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">commander</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> targetFile </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#BABED8;">(__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../dist/package.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> packagejson </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">require</span><span style="color:#BABED8;">(targetFile)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> currentVersion </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> packagejson</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">version</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> versionArr </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> currentVersion</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">mainVersion</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> subVersion</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> phaseVersion</span><span style="color:#89DDFF;">]</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> versionArr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 默认版本号</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> defaultVersion </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#BABED8;">mainVersion</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">subVersion</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">\${</span><span style="color:#89DDFF;">+</span><span style="color:#BABED8;">phaseVersion</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#BABED8;"> newVersion </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> defaultVersion</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 从命令行参数中取版本号</span></span>
<span class="line"><span style="color:#BABED8;">program</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">option</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-v, --versions &lt;type&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Add release version number</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> defaultVersion)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">program</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#BABED8;">(process</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">argv)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> (program</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">versions) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">newVersion</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">program</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">versions</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">publish</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">shelljs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sed</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-i</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&quot;name&quot;: &quot;ktools&quot;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&quot;name&quot;: &quot;@kagol/ktools&quot;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">targetFile</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 修改包名</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">shelljs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sed</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-i</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&quot;version&quot;: &quot;</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">currentVersion</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&quot;version&quot;: &quot;</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">newVersion</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">targetFile</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 修改版本号</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">shelljs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cd</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">shelljs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exec</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">npm publish</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 发布</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">publish</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>这里最核心的两步：</p><ol><li>修改包名</li><li>获取正确的版本号并修改</li></ol><p>其中修改文件使用 shelljs 库，获取版本号参数使用了 <a href="https://github.com/tj" target="_blank" rel="noreferrer">TJ</a> 大神的 <a href="https://github.com/tj/commander.js" target="_blank" rel="noreferrer">commander</a> 工具。</p><p>需要提前安装这两个依赖库：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-D</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">shelljs</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">commander</span></span></code></pre></div><p>另外需要在 package.json 中增加构建的脚本命令：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rollup -c &amp;&amp; npm run copy</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,</span></span></code></pre></div><h4 id="step-3-发布" tabindex="-1">Step 3: 发布 <a class="header-anchor" href="#step-3-发布" aria-label="Permalink to &quot;Step 3: 发布&quot;">​</a></h4><p>发布的步骤比较简单，已经放在 publish.js 脚本文件中。</p><p>每次发布只需要依次运行以下命令即可：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">run</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">run</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">publish</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-v</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">.2</span></span></code></pre></div><p>后续可以考虑将其集成到流水线，实现完全的自动化部署，这里可以参考我之前写的一篇文章：<a href="https://juejin.cn/post/6887961766170066951" target="_blank" rel="noreferrer">大厂是如何用DevCloud流水线实现自动化部署Web应用的？</a></p><h2 id="_4-小结" tabindex="-1">4 小结 <a class="header-anchor" href="#_4-小结" aria-label="Permalink to &quot;4 小结&quot;">​</a></h2><p>本文详细地介绍了使用 Rollup + TypeScript 打造一个开源工具库的流程和步骤，并介绍如何配置 Rollup 和 TypeScript，如何编写部署脚本自动化发布工具库到 npm 仓库。希望大家喜欢，并欢迎给个 Star 🌟 鼓励，以下是 ktools 工具库的源码地址：</p><p><a href="https://github.com/kagol/ktools" target="_blank" rel="noreferrer">https://github.com/kagol/ktools</a></p>`,158);function B(E,A,C,u,d,h){const s=n("EditInfo");return l(),o("div",null,[i,p(s,{time:"2020年12月05日 14:45",title:"阅读 3588 · 点赞 75 · 评论 14 · 收藏 98"})])}const f=a(F,[["render",B]]);export{m as __pageData,f as default};
