import{_ as a,B as s,o as n,c as l,G as o,Q as i}from"./chunks/framework.1fee3549.js";const y=JSON.parse('{"title":"从0到1搭建Vue组件库09：Monorepo改造","description":"","frontmatter":{},"headers":[],"relativePath":"tech/2021/0-to-1-build-vue-component-library-9.md","filePath":"tech/2021/0-to-1-build-vue-component-library-9.md"}'),p={name:"tech/2021/0-to-1-build-vue-component-library-9.md"},c=i(`<h1 id="从0到1搭建vue组件库09-monorepo改造" tabindex="-1">从0到1搭建Vue组件库09：Monorepo改造 <a class="header-anchor" href="#从0到1搭建vue组件库09-monorepo改造" aria-label="Permalink to &quot;从0到1搭建Vue组件库09：Monorepo改造&quot;">​</a></h1><p><img src="https://user-images.githubusercontent.com/9566362/201511144-b05b690e-7294-4d9f-ad8c-d5c707fc43fd.png" alt="image"></p><h2 id="_0-上期直播回顾" tabindex="-1">0 上期直播回顾 <a class="header-anchor" href="#_0-上期直播回顾" aria-label="Permalink to &quot;0 上期直播回顾&quot;">​</a></h2><p>上一次带着大家将【Vue DevUI开源指南】系列直播1-6期的所有内容串起来了，并诞生了<a href="https://github.com/57code/mini-vue-devui" target="_blank" rel="noreferrer">mini-vue-devui</a>项目，<code>mini-vue-devui</code>是一个迷你版的组件库产品，目前包含：</p><ol><li><code>vite</code>+<code>vue3</code>+<code>ts</code>+<code>jsx</code>+<code>sass</code>的基础工程</li><li>基于<code>vitepress</code>+<code>vitepress-theme-demoblock</code>的文档系统</li><li><code>jest</code>+<code>@vue/test-utils</code>的单元测试环境</li><li>一个用<code>jsx</code>编写的初版Tree组件</li><li>一个初版<code>devui-cli</code>脚手架</li></ol><p>直播的最后，我们快速过了一下单元测试环境搭建的流程，但并没有手把手教，而是留了一个作业，这个作业最后由<a href="https://github.com/57code/mini-vue-devui/pull/1" target="_blank" rel="noreferrer">QbjGKNick</a>同学率先提交。</p><p>上一次直播的文章：</p><ol><li><a href="https://juejin.cn/post/7024443197854056456" target="_blank" rel="noreferrer">手把手带你从0到1搭建一个vue3组件库：mini-vue-devui</a></li><li><a href="https://juejin.cn/post/7023409900239716382" target="_blank" rel="noreferrer">【我要做开源】给 vue devui 组件库项目增加单元测试</a></li></ol><p>但这就是一个组件库的全部了吗？</p><p>这只是冰山一角而已。</p><p>这一期我们将继续之前的直播，完善<code>mini-vue-devui</code>项目，增加<code>Monorepo</code>支持，并打通组件库按需构建的流程。</p><h2 id="_1-为什么要做-monorepo-改造" tabindex="-1">1 为什么要做 monorepo 改造 <a class="header-anchor" href="#_1-为什么要做-monorepo-改造" aria-label="Permalink to &quot;1 为什么要做 monorepo 改造&quot;">​</a></h2><h3 id="_1-1-启动-mini-vue-devui" tabindex="-1">1.1 启动 mini-vue-devui <a class="header-anchor" href="#_1-1-启动-mini-vue-devui" aria-label="Permalink to &quot;1.1 启动 mini-vue-devui&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">## 克隆代码仓库到本地</span></span>
<span class="line"><span style="color:#babed8;">git clone https://github.com/57code/mini-vue-devui.git</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">## 安装依赖</span></span>
<span class="line"><span style="color:#babed8;">yarn // or npm i</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">## 本地启动</span></span>
<span class="line"><span style="color:#babed8;">yarn docs:dev // or npm run docs:dev</span></span></code></pre></div><p>效果如下：</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9d7006e8fd145de91e9dde7b7bd02b5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h3 id="_1-2-lerna-简介" tabindex="-1">1.2 lerna 简介 <a class="header-anchor" href="#_1-2-lerna-简介" aria-label="Permalink to &quot;1.2 lerna 简介&quot;">​</a></h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0c00468ada741c9869a3d6dbfcb8ffa~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p><a href="https://lerna.js.org/" target="_blank" rel="noreferrer">lerna</a>官网这种图很形象地表示了lerna是做什么的：</p><blockquote><p>整个多头龙的身体代表单体仓库，每个龙头代表一个个的子包，每个子包是独立的（每个龙头有自主意识），独立测试、独立启动、独立构建、独立部署互不影响。</p></blockquote><p>简单来说，<code>lerna</code>就是一个用于管理具有多个包的JavaScript项目的工具。</p><p>我们一起来看看怎么使用<code>lerna</code>，并使用<code>yarn</code>+<code>lerna</code>将我们的<code>mini-vue-devui</code>项目改造成monorepo形式。</p><p>参考：</p><ol><li>lerna 官网：<a href="https://lerna.js.org/" target="_blank" rel="noreferrer">https://lerna.js.org/</a></li><li>源码：<a href="https://github.com/lerna/lerna" target="_blank" rel="noreferrer">https://github.com/lerna/lerna</a></li></ol><h3 id="_1-3-mini-vue-devui-目前的目录结构" tabindex="-1">1.3 mini-vue-devui 目前的目录结构 <a class="header-anchor" href="#_1-3-mini-vue-devui-目前的目录结构" aria-label="Permalink to &quot;1.3 mini-vue-devui 目前的目录结构&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">mini-vue-devui</span></span>
<span class="line"><span style="color:#babed8;">├── devui // vue devui 组件库</span></span>
<span class="line"><span style="color:#babed8;">├── devui-cli // devui cli 脚手架工具</span></span>
<span class="line"><span style="color:#babed8;">├── docs // vitepress 文档系统</span></span>
<span class="line"><span style="color:#babed8;">├── index.html</span></span>
<span class="line"><span style="color:#babed8;">├── jest.config.js</span></span>
<span class="line"><span style="color:#babed8;">├── lib</span></span>
<span class="line"><span style="color:#babed8;">├── node_modules</span></span>
<span class="line"><span style="color:#babed8;">├── package-lock.json</span></span>
<span class="line"><span style="color:#babed8;">├── package.json</span></span>
<span class="line"><span style="color:#babed8;">├── public</span></span>
<span class="line"><span style="color:#babed8;">├── README.md</span></span>
<span class="line"><span style="color:#babed8;">├── src</span></span>
<span class="line"><span style="color:#babed8;">├── tsconfig.json</span></span>
<span class="line"><span style="color:#babed8;">├── vite.config.ts</span></span>
<span class="line"><span style="color:#babed8;">└── yarn.lock</span></span></code></pre></div><p>可以看到：</p><ol><li>devui // vue devui 组件库</li><li>devui-cli // devui cli 脚手架工具</li><li>docs // vitepress 文档系统</li></ol><p>这三个最关键的模块都放在根目录下面，这样显得很混乱，并且不方便子模块的扩展，比如以后想做一个</p><ul><li><code>eslint-config-plugin</code></li><li>或者<code>devui-vscode-plugin</code></li><li>或者<code>vue-devui-admin</code></li><li>又或者是<code>react-devui</code></li></ul><p>这些子模块应该放在哪里呢？</p><p>如果全部放在根目录下，将会一片混乱，不可维护。</p><p>如果每一个都拆成一个代码仓库，又会存在</p><ul><li>代码复用的问题</li><li>仓库的依赖重复安装的问题</li><li>仓库之间切换的成本</li></ul><p>这就是<code>lerna</code>发挥价值的地方。</p><h2 id="_2-如何使用-lerna-将-mini-vue-devui-改造成-monorepo-方式" tabindex="-1">2 如何使用 lerna 将 mini-vue-devui 改造成 monorepo 方式？ <a class="header-anchor" href="#_2-如何使用-lerna-将-mini-vue-devui-改造成-monorepo-方式" aria-label="Permalink to &quot;2 如何使用 lerna 将 mini-vue-devui 改造成 monorepo 方式？&quot;">​</a></h2><h3 id="_2-1-全局安装-lerna" tabindex="-1">2.1 全局安装 lerna <a class="header-anchor" href="#_2-1-全局安装-lerna" aria-label="Permalink to &quot;2.1 全局安装 lerna&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">npm i lerna -g</span></span></code></pre></div><h3 id="_2-2-初始化-lerna-工程" tabindex="-1">2.2 初始化 lerna 工程 <a class="header-anchor" href="#_2-2-初始化-lerna-工程" aria-label="Permalink to &quot;2.2 初始化 lerna 工程&quot;">​</a></h3><p>创建<code>mini-vue-devui</code>目录，在根目录下执行</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">lerna init</span></span></code></pre></div><p>配置<code>lerna.json</code>文件</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">{</span></span>
<span class="line"><span style="color:#babed8;">  &quot;packages&quot;: [</span></span>
<span class="line"><span style="color:#babed8;">    &quot;packages/*&quot;</span></span>
<span class="line"><span style="color:#babed8;">  ],</span></span>
<span class="line"><span style="color:#babed8;">  &quot;version&quot;: &quot;0.0.0&quot;,</span></span>
<span class="line"><span style="color:#babed8;">  &quot;npmClient&quot;: &quot;yarn&quot;, // 新增，使用 yarn 包管理工具</span></span>
<span class="line"><span style="color:#babed8;">  &quot;useWorkspaces&quot;: true // 新增，使用 yarn workspaces</span></span>
<span class="line"><span style="color:#babed8;">}</span></span></code></pre></div><p>配置<code>package.json</code></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">{</span></span>
<span class="line"><span style="color:#babed8;">  &quot;name&quot;: &quot;mini-vue-devui&quot;,</span></span>
<span class="line"><span style="color:#babed8;">  &quot;private&quot;: true,</span></span>
<span class="line"><span style="color:#babed8;">  &quot;devDependencies&quot;: {</span></span>
<span class="line"><span style="color:#babed8;">    &quot;lerna&quot;: &quot;^4.0.0&quot;</span></span>
<span class="line"><span style="color:#babed8;">  },</span></span>
<span class="line"><span style="color:#babed8;">  </span></span>
<span class="line"><span style="color:#babed8;">  // 新增，配置 packages 目录</span></span>
<span class="line"><span style="color:#babed8;">  &quot;workspaces&quot;: [</span></span>
<span class="line"><span style="color:#babed8;">    &quot;packages/*&quot;</span></span>
<span class="line"><span style="color:#babed8;">  ]</span></span>
<span class="line"><span style="color:#babed8;">}</span></span></code></pre></div><h3 id="_2-3-添加子包" tabindex="-1">2.3 添加子包 <a class="header-anchor" href="#_2-3-添加子包" aria-label="Permalink to &quot;2.3 添加子包&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">lerna create devui-vue -y</span></span></code></pre></div><p>将<code>mini-vue-devui</code>中的全部文件拷贝到<code>packages/devui-vue</code>目录中。</p><h3 id="_2-4-安装依赖" tabindex="-1">2.4 安装依赖 <a class="header-anchor" href="#_2-4-安装依赖" aria-label="Permalink to &quot;2.4 安装依赖&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">lerna bootstrap</span></span></code></pre></div><h3 id="_2-5-本地启动" tabindex="-1">2.5 本地启动 <a class="header-anchor" href="#_2-5-本地启动" aria-label="Permalink to &quot;2.5 本地启动&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">lerna exec --scope mini-vue-devui yarn docs:dev</span></span></code></pre></div><p>启动成功！</p><h3 id="_2-6-构建" tabindex="-1">2.6 构建 <a class="header-anchor" href="#_2-6-构建" aria-label="Permalink to &quot;2.6 构建&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">lerna exec --scope mini-vue-devui yarn docs:build</span></span></code></pre></div><p>构建成功！</p><h2 id="_3-抽离-devui-cli" tabindex="-1">3 抽离 devui-cli <a class="header-anchor" href="#_3-抽离-devui-cli" aria-label="Permalink to &quot;3 抽离 devui-cli&quot;">​</a></h2><h3 id="测试下功能" tabindex="-1">测试下功能 <a class="header-anchor" href="#测试下功能" aria-label="Permalink to &quot;测试下功能&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">// 构建cli文件</span></span>
<span class="line"><span style="color:#babed8;">lerna exec --scope mini-vue-devui yarn cli:build</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">// 执行cli命令，创建组件模板</span></span>
<span class="line"><span style="color:#babed8;">lerna exec --scope mini-vue-devui yarn cli</span></span></code></pre></div><h3 id="创建-devui-cli-子包" tabindex="-1">创建 devui-cli 子包 <a class="header-anchor" href="#创建-devui-cli-子包" aria-label="Permalink to &quot;创建 devui-cli 子包&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">lerna create devui-cli -y</span></span></code></pre></div><p>将<code>packages/devui-vue/devui-cli</code>中的全部文件拷贝到<code>packages/devui-cli</code>目录中。</p><h3 id="再次测试功能" tabindex="-1">再次测试功能 <a class="header-anchor" href="#再次测试功能" aria-label="Permalink to &quot;再次测试功能&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">// 构建cli文件</span></span>
<span class="line"><span style="color:#babed8;">lerna exec --scope mini-vue-devui yarn cli:build</span></span>
<span class="line"><span style="color:#babed8;"></span></span>
<span class="line"><span style="color:#babed8;">// 执行cli命令，创建组件模板</span></span>
<span class="line"><span style="color:#babed8;">lerna exec --scope mini-vue-devui yarn cli</span></span></code></pre></div><p>运行正常！</p><h2 id="devui-开源招募" tabindex="-1">DevUI 开源招募 <a class="header-anchor" href="#devui-开源招募" aria-label="Permalink to &quot;DevUI 开源招募&quot;">​</a></h2><p>加入<a href="https://devui.design/" target="_blank" rel="noreferrer">DevUI</a>开源生态建设你将收获什么？</p><p>直接的价值：</p><ol><li>通过打造一个实际的<a href="https://gitee.com/devui/vue-devui" target="_blank" rel="noreferrer">vue3组件库项目</a>，学习最新的<code>Vite</code>+<code>Vue3</code>+<code>TypeScript</code>+<code>JSX</code>技术</li><li>学习从0到1搭建一个自己的组件库的整套流程和方法论，包括组件库工程化、组件的设计和开发等</li><li>为自己的简历和职业生涯添彩，参与过优秀的开源项目，这本身就是受面试官青睐的亮点</li><li>结识一群优秀的、热爱学习、热爱开源的小伙伴，大家一起打造一个伟大的产品</li></ol><p>长远的价值：</p><ol><li>打造个人品牌，提升个人影响力</li><li>培养良好的编码习惯</li><li>获得华为云DevUI团队的荣誉&amp;认可和定制小礼物</li><li>成为PMC&amp;Committer之后还能参与DevUI整个开源生态的决策和长远规划，培养自己的管理和规划能力</li><li>未来有更多机会和可能</li></ol><p>DevUI开源，未来可期！</p><p>添加DevUI小助手微信：<code>devui-official</code>，拉你到我们的官方交流群。</p><p>这是我们的开源故事：</p><p><a href="https://juejin.cn/post/7029092585452863525" target="_blank" rel="noreferrer">DevUI开源的故事</a></p>`,75);function t(r,d,u,b,h,v){const e=s("EditInfo");return n(),l("div",null,[c,o(e,{time:"2021年11月11日 18:49",title:"阅读 3551 ·  点赞 25 ·  评论 10 ·  收藏 9"})])}const g=a(p,[["render",t]]);export{y as __pageData,g as default};
